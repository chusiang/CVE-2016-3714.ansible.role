---
#!/usr/bin/env ansible-playbook
# vim:ft=ansible :
# tasks file for CVE-2016-3714.ansible.role

- name: backup "policy.xml"
  become: yes
  command: cp -n {{ policy_path }} {{ policy_path }}.ori
  when: filecheck.stat.exists

- name: modify "policy.xml"
  become: yes
  template:
    src: ./templates/policy.xml.j2
    dest: {{ policy_path }}
  when: filecheck.stat.exists

- name: create "exploit.png"
  template:
    src: ./templates/exploit.png.j2
    dest: /tmp/exploit.png
  when: filecheck.stat.exists

- name: run injection script
  command: convert exploit.png out.png chdir=/tmp/
  register: run_injection
  ignore_errors: yes

- name: file check
  stat: path={{ injection_dest }}
  register: filecheck

- name: result for fixed
  debug: msg="We Fixed It ! :D"
  when: filecheck.stat.exists == false

- name: result for not yet
  debug: msg="We have vulnerability now. :("
  when: filecheck.stat.exists == true

